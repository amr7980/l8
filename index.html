<!DOCTYPE html>
<html lang="en" ng-app="cartApp">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PSU Storefront - Shopping Cart</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Poppins Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Our Custom CSS -->
  <link rel="stylesheet" href="styles.css">
</head>
<body ng-controller="cartController">

  <!-- Header (same look & feel) -->
  <header class="bg-primary text-white text-center py-5 shadow-sm">
    <div class="container">
      <h1 class="display-4">Nittany Exchange ü¶Å</h1>
      <p class="lead">Review your cart, adjust quantities, and get ready to check out.</p>
    </div>
  </header>

  <main class="container my-5">
    <div class="row g-4">
      <!-- Products: Search + List -->
      <section class="col-lg-6">
        <div class="card p-4 shadow-sm h-100">
          <div class="d-flex align-items-center gap-2 mb-3">
            <h2 class="h4 mb-0">Browse Products</h2>
            <span class="badge bg-primary ms-auto">{{ (products | filter:searchQuery).length }} found</span>
          </div>

          <div class="input-group mb-3">
            <span class="input-group-text" id="search-label">Search</span>
            <input type="text"
                   class="form-control"
                   aria-labelledby="search-label"
                   placeholder="Try 'hoodie', 'hat', 'sticker'..."
                   ng-model="searchQuery">
          </div>

          <div class="row row-cols-1 row-cols-md-2 g-3">
            <div class="col" ng-repeat="p in products | filter:searchQuery">
              <div class="card h-100 product-card">
                <img ng-src="{{p.image}}" class="card-img-top" alt="{{p.name}}">
                <div class="card-body d-flex flex-column">
                  <h3 class="h6 card-title mb-1">{{p.name}}</h3>
                  <p class="text-muted small mb-2">{{p.description}}</p>
                  <div class="mt-auto d-flex align-items-center justify-content-between">
                    <strong>{{p.price | currency}}</strong>
                    <button class="btn btn-primary btn-sm"
                            ng-click="addToCart(p)">
                      Add to Cart
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="text-muted" ng-if="(products | filter:searchQuery).length === 0">
              No products match your search.
            </div>
          </div>
        </div>
      </section>

      <!-- Cart -->
      <section class="col-lg-6">
        <div class="card p-4 shadow-sm h-100">
          <div class="d-flex align-items-center mb-3">
            <h2 class="h4 mb-0">Your Cart</h2>
            <span class="badge bg-primary ms-2">{{cartCount()}} items</span>
            <button class="btn btn-outline-danger btn-sm ms-auto"
                    ng-disabled="cart.length === 0"
                    ng-click="clearCart()">
              Clear Cart
            </button>
          </div>

          <div class="table-responsive mb-3" ng-if="cart.length > 0">
            <table class="table align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th scope="col">Item</th>
                  <th scope="col" class="text-center">Qty</th>
                  <th scope="col" class="text-end">Price</th>
                  <th scope="col" class="text-end">Subtotal</th>
                  <th scope="col" class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="item in cart track by item.id">
                  <td>
                    <div class="d-flex align-items-center">
                      <img ng-src="{{item.image}}" class="rounded me-2 cart-thumb" alt="{{item.name}}">
                      <div>
                        <div class="fw-semibold">{{item.name}}</div>
                        <div class="text-muted small">{{item.description}}</div>
                      </div>
                    </div>
                  </td>
                  <td class="text-center" style="width: 110px;">
                    <input type="number"
                           class="form-control form-control-sm text-center"
                           min="1"
                           ng-model="item.qty"
                           ng-change="updateQty(item)">
                  </td>
                  <td class="text-end">{{ item.price | currency }}</td>
                  <td class="text-end">{{ (item.price * item.qty) | currency }}</td>
                  <td class="text-end">
                    <button class="btn btn-outline-secondary btn-sm me-1"
                            ng-click="decrement(item)">
                      ‚àí
                    </button>
                    <button class="btn btn-outline-secondary btn-sm me-1"
                            ng-click="increment(item)">
                      +
                    </button>
                    <button class="btn btn-outline-danger btn-sm"
                            ng-click="removeFromCart(item)">
                      Remove
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="text-center text-muted" ng-if="cart.length === 0">
            Your cart is empty. Start adding some PSU gear!
          </div>

          <!-- Totals -->
          <div class="mt-4" ng-if="cart.length > 0">
            <div class="d-flex justify-content-between">
              <span class="text-muted">Subtotal</span>
              <strong>{{ subtotal() | currency }}</strong>
            </div>
            <div class="d-flex justify-content-between">
              <span class="text-muted">Estimated Tax (6%)</span>
              <strong>{{ tax() | currency }}</strong>
            </div>
            <hr>
            <div class="d-flex justify-content-between fs-5">
              <span>Total</span>
              <strong>{{ total() | currency }}</strong>
            </div>

            <div class="d-grid mt-3">
              <!-- Link this to your existing flow -->
              <a href="shipping.html" class="btn btn-primary btn-lg">
                Proceed to Shipping
              </a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="bg-primary text-white text-center py-3">
    <p class="mb-0">&copy; 2025 Nittany Exchange. We Are!</p>
  </footer>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

  <!-- Inline Angular (you can move this to app.js if you prefer) -->
  <script>
    (function () {
      'use strict';
      angular.module('cartApp', [])
        .controller('cartController', ['$scope', function ($scope) {

          // Demo catalog (replace with your real data source)
        $scope.products = [
  { id: 1, name: 'PSU T-Shirt', description: 'Unisex cotton, navy', price: 19.99, image: 'https://picsum.photos/seed/psu-tshirt/400/240' },
  { id: 2, name: 'PSU Mug', description: 'Ceramic, 12 oz', price: 12.99, image: 'https://picsum.photos/seed/psu-mug/400/240' },
  { id: 3, name: 'Keurig K-Mini Coffee Maker', description: 'Single-serve, gently used', price: 59.00, image: 'https://picsum.photos/seed/keurig/400/240' },
  { id: 4, name: 'Mini Fridge', description: '3.2 cu ft, works great', price: 110.00, image: 'https://picsum.photos/seed/minifridge/400/240' },
  { id: 5, name: 'Statistics Textbook', description: 'Intro to Statistics, 10th ed.', price: 48.00, image: 'https://picsum.photos/seed/statistics-textbook/400/240' },
  { id: 6, name: 'Psychology Textbook', description: 'General Psychology, 6th ed.', price: 42.00, image: 'https://picsum.photos/seed/psychology-textbook/400/240' }
];


          $scope.cart = [];

          function findInCart(id) {
            return $scope.cart.find(i => i.id === id);
          }

          $scope.addToCart = function (p) {
            var existing = findInCart(p.id);
            if (existing) {
              existing.qty += 1;
            } else {
              $scope.cart.push({ ...p, qty: 1 });
            }
          };

          $scope.removeFromCart = function (item) {
            $scope.cart = $scope.cart.filter(i => i.id !== item.id);
          };

          $scope.increment = function (item) {
            item.qty += 1;
          };

          $scope.decrement = function (item) {
            item.qty = Math.max(1, item.qty - 1);
          };

          $scope.updateQty = function (item) {
            if (!item.qty || item.qty < 1) item.qty = 1;
          };

          $scope.clearCart = function () {
            $scope.cart = [];
          };

          $scope.cartCount = function () {
            return $scope.cart.reduce((n, i) => n + i.qty, 0);
          };

          $scope.subtotal = function () {
            return $scope.cart.reduce((sum, i) => sum + i.price * i.qty, 0);
          };

          $scope.tax = function () {
            return $scope.subtotal() * 0.06; // PA-ish estimate
          };

          $scope.total = function () {
            return $scope.subtotal() + $scope.tax();
          };
        }]);
    })();
  </script>
</body>
</html>
